"use strict";function initLengend(){for(var o in media){var e=$('<a class="circle '+mediaEN[o]+'"></a><a>'+media[o]+"</a>");$(".legend-container").append(e)}}function initWordCollection(){$("#modal-closer").on("click",function(){$("#modal-container").removeClass("show"),$("#pop-content .card-container").removeClass("show"),$("body,html").css("overflow","")})}function initTitleAnalysis(o){var e=["provocative","ptt_idiom"];for(m in media){var n=media[m];for(k in e){var t=0;for(i in o[n][e[k]]){var a=e[k],s=o[n][e[k]][i].title,r=o[n][e[k]][i].url,l=o[n][e[k]][i].word;if(a=a.replace("_","-"),t>=4)t++;else{var d=window.mediaNameTranslate(n);titleAnalysisAddNewsCard(d,a,s,l,r),t++}}}}for(m in media){var n=media[m];for(k in e){var a=e[k];if(a=a.replace("_","-"),count=o[n][e[k]].length-4,count>=1){var d=window.mediaNameTranslate(n);titleAnalysisAddNewsNum(d,a,count)}}}}function showAbout(){setTimeout(function(){$(".nav-about .fa-arrow-right").addClass("show-about");var o=$(window).scrollTop();$("#about").css("top",o+"px"),$("body,html").css("overflow","hidden")},750)}function hideAbout(){$(".nav-about .fa-arrow-right").removeClass("show-about"),$("body,html").css("overflow","")}function isPosBeyondIdTop(o,e){return o>=$(e).offset().top}function animateToId(o){$("body,html").animate({scrollTop:$(o).offset().top-50},"slow")}function initDate(o){var e=o.begin.replace("-",".").slice(5),n=o.end.replace("-",".").slice(5),t=e+"~"+n;$(".nav-time").html(t)}var report,provocative_list=[];initLengend(),initWordCollection(),window.refreshCards(),$("#logo").addClass("loading"),$("#logo").addClass("small"),$("#help").hide();var IsReportGot=!1;$("#logo").one("animationiteration webkitAnimationIteration",function(){IsReportGot&&($("#logo").removeClass("loading"),setTimeout(function(){$("#logo").removeClass("small")},10))});var now=moment.now(),tz=moment.tz(now,"Asia/Taipei"),weekNum=tz.format("W"),s3Url="https://s3-ap-northeast-1.amazonaws.com/tw-media-data/report/",objectUrl=s3Url+"week_"+weekNum+".json";$.getJSON(objectUrl,function(o){report=o,IsReportGot=!0;var e=0;for(var n in media)e+=report[media[n]].news_count;$("#num-news").text(e);var t=[];for(var i in media)t.push({title:media[i],newsCount:report[media[i]].news_count});setTimeout(function(){window.createNewsBarChart("#num-news-bar",t)},100);var a={};media.forEach(function(o){a[o]=report[o]}),window.createCategory(a);var s=wordCloud("div.cloud");window.showNewWords(s);for(var i in mediaEN)window.addVisWord(mediaEN[i],report[media[i]].words_median);$(".page-container").css("display",""),$(".page-container").addClass("show-page"),setTimeout(function(){$(".page-container").removeClass("show-page")},1e3),initBuzzword(o.buzzword),initWordAnalysis(o.word_analysis),initDate(o.time),initAbout();var r=d3.selectAll("text").filter(function(e,n){return e.text===o.buzzword.word});$(r[0]).d3Click(),$("#help").show("slow"),$("#help .fa-question").hide(),$("#help").on("click",function(){$("#help .content").toggle("slow"),$("#help .fa-angle-down").toggle("slow"),$("#help .fa-question").toggle("slow")})}),$(".nav-about").on("click",function(){$(".page-container").hasClass("show-about")?($(".page-container").addClass("hide-about").removeClass("show-about"),hideAbout()):$(".page-container").hasClass("hide-about")?($(".page-container").addClass("show-about").removeClass("hide-about"),showAbout()):($(".page-container").addClass("show-about"),showAbout())}),$(".menu").on("click",function(){$(".container").hasClass("is-open")?($(".menu").removeClass("is-active"),$(".container").removeClass("is-open")):($(".menu").addClass("is-active"),$(".container").addClass("is-open"))}),$.get("dist/provocative_words.txt",function(o){provocative_list=o.split("\n")}),$("body").on("scroll",function(o){var e=.75*$(window).height(),n=$(window).scrollTop()+e;if(isPosBeyondIdTop(n,".cloud")?$(".legend-container").removeClass("hidden"):$(".legend-container").addClass("hidden"),isPosBeyondIdTop(n,"#word-collection")){var t="<h4>詞彙新聞集</h4>",i=t+"點擊用詞雲中的詞語，可以在詞彙新聞集中查看 6 家媒體報導此詞語的時間軸，與各自的新聞，其中<em>上色者為情緒性報導</em>。";$("#help .content").html(i)}else if(isPosBeyondIdTop(n,".cloud")){var t="<h4>媒體用詞雲</h4>",i=t+"統計 6 家媒體本週新聞標題內的用詞，在標題內<em>出現次數越多者字體越大</em>。";$("#help .content").html(i)}else if(isPosBeyondIdTop(n,".horizontal-lists")){var t="<h4>標題用詞報告</h4>",i=t+"<hr><strong>情緒性報導排行</strong>統計 6 家媒體本週情緒性報導比率的前五名，例如：「台灣  50%」，代表這家媒體所有標題含有「台灣」的報導，標題有 50% 含有情緒性用詞。</p>\n<hr><strong>少量報導主題</strong>分析同一詞語在 6 家媒體中，如果這家媒體對於這個詞語的關注度較低，即為少量報導主題。</p>";$("#help .content").html(i)}else if(isPosBeyondIdTop(n,"#buzzword")){var t="<h4>本週熱詞</h4>",a=provocative_list.map(function(o){return"<li>"+o+"</li>"}).join(" "),i=t+"統計本週搜集的所有新聞標題內的用詞，與上週資料做比較，<em>使用次數成長最多者</em>，即為本週的熱詞。\n<hr>\n<strong>情緒性報導</strong>\n透過分析新聞資料的內文與標題，並以詞語向量化 ( word2vec ) 、群聚 ( cluster ) 的技術，找出與「酸」相近的用詞集，並作為以下定義的「情緒性用詞」。\n而情緒性報導是為，新聞標題中含有情緒性用詞的報導，此處統計各家媒體報導本週熱詞時情緒性報導的比率。「情緒性用詞」包含<ol>"+a+"</ol><hr><strong>報導數量</strong>統計 6 家媒體對本周熱詞的報導數量，分析其數量。";$("#help .content").html(i)}else{var t="",i=t+"統計6家媒體於官方網站上，一周內所發表之新聞量。\n    <hr><strong>資料來源</strong>\n    <ol>\n    <li>蘋果日報</li>\n    <li>聯合報</li>\n    <li>自由時報</li>\n    <li>東森新聞雲</li>\n    <li>中央通訊社</li>\n    <li>中國時報</li>\n    </ol>\n    ";$("#help .content").html(i)}}),$(".nav li").on("click",function(o){var e=o.target.id;if("button1"===e)$("html, body").animate({scrollTop:0},"slow");else if("button2"===e){$("#report").offset();animateToId("#report")}else"button3"===e&&animateToId("#discussion")});